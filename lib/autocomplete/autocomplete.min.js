!function(a,b,c,d){function g(b,c){this.element=b,this.options=a.extend({},f,c),this._defaults=f,this._name=e,this.init()}var e="autocomplete",f={url:"",data:[]};g.prototype.init=function(){var e,b=a(this.element),d=this;b.wrap("<div class='autocomplete'></div>"),e=b.parent(),d.input=a('<input type=text class="autocomplete__input" placeholder="'+b.attr("placeholder")+'">').insertAfter(b).width(parseInt(b.css("width"))),d.results=a('<div class="autocomplete__results"></div>').insertAfter(a(d.input)).hide().width(parseInt(a(d.input).css("width"))),d.error=a('<div class="autocomplete__error">Выберите значение из списка</div>').insertAfter(a(d.input)),b.hide(),a(d.results).on("mousewheel DOMMouseScroll",function(b){var c=null;"mousewheel"===b.type?c=b.originalEvent.wheelDelta*-1:"DOMMouseScroll"===b.type&&(c=40*b.originalEvent.detail),c&&(b.preventDefault(),a(this).scrollTop(c+a(this).scrollTop()))}),a(d.results).on("click",".autocomplete__item",function(){a(this).parent().children().removeClass("is-active"),a(this).addClass("is-active"),b.val(a(this).data("id")),a(d.input).val(a(this).text()),a(d.results).hide()}),d.input.on("focus",function(){e.addClass("is-active"),a(this).removeClass("autocomplete__has-error"),a(this).select(),a(d.results).addClass("is-active").show()}),a(c).click(function(b){a(b.target).closest(".autocomplete")[0]!==a(d.element).parent()[0]&&(e.removeClass("is-active"),a(d.results).hide(),""==a(d.element).val()&&""!=a(d.input).val()&&a(d.input).addClass("autocomplete__has-error"))}),this.options.url?a.getJSON(this.options.url,function(a){d.data=a}):this.options.data?d.data=this.options.data:(d.data=[],console.log("No data")),d.input.on("keyup",function(){var b=a.trim(a(this).val());if(a(d.results).html(""),a(d.element).val(""),b.length>0){var c,e=0;a(d.results).show();for(var f=0;f<d.data.length;f++){var g=d.data[f];c=new RegExp("^"+b,"i"),g.City.search(c)!=-1&&e++<5&&a(d.results).append('<div class="autocomplete__item" data-id="'+g.Id+'">'+g.City+"</div>"),g.City==b&&a(d.element).val(g.Id)}0==e&&a(d.results).append('<div class="autocomplete__empty">Не найдено</div>'),e>5&&a(d.results).append('<div class="autocomplete__text">Показано 5 из '+e+" элемнетов. Уточните запрос, чтобы увидеть остальные</div>")}})},a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new g(this,b))})}}(jQuery,window,document);